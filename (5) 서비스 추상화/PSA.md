# 서비스 추상화     

지금까지 예제의 DAO에 트랜잭션을 적용해보면서 스프링이 어떻게 성격이 비슷한 여러 기술을 추상화하고 일관된 방법으로 사용할 수 있는지 공부해보자.     


## 사용자 레벨 관리 기능 추가       

#### 1. 필드 추가          
지금까지 DAO는 DB에 넣고 빼는 것을 제외하면 어떤 비즈니스 로직도 갖고있지 않다.   
간단한 비즈니스 로직을 추가해보자. 사용자의 활동 내역을 참고해서 레벨을 조정해주는 기능을 넣어보자.     
Enum으로 Level을 생성하고 User 필드에 추가한다.     


#### 2. UserDaoJdbc 수정     

`INSERT` 문장이 들어있는 `add()` 메소드의 SQL과 조회작업에서 추가된 필드를 넣는다.     
사용자의 레벨 정보 변경을 위해 사용자 정보를 변경하는 `update()` 메소드를 구현한다.     


- 수정 테스트 보완      

JDBC 개발에서 리소스 반환과 같은 기본 작업을 제외하고 가장 많은 실수가 일어나는 곳은 SQL 문장이다.       
필드 이름이나 SQL 키워드 실수는 테스트에서 쉽게 발견할 수 있는데 `UPDATE` 문장에서 `WHERE` 절을 빼먹는 경우     
아무런 경고 없이 정상적으로 동작하는 것처럼 보인다.       
이 문제의 해결방법은 두 가지이다.   

(1) `update()` 리턴 값 확인하기 - 영향을 받은 로우의 개수가 1 이상이면 문제가 있는 것                      
(2) 테스트를 보강해서 원하는 사용자 외의 정보는 수정되지 않았음을 직접 확인하는 것                
사용자를 두 명 등록해 놓고 그 중 하나만 수정한 후, 수정된 사용자와 수정하지 않은 사용자 정보를 모두 확인해본다.   
                

#### 3. `UserService.upgradeLevels()`      

사용자 관리 로직은 어디에 두는 게 좋을까?       
비즈니스 로직 서비스를 제공한다는 의미에서 클래스 이름을 `UserService`로 하고 여기에 구현하자.       
`UserService`는 `UserDao`의 인터페이스 타입으로 userDao 빈을 DI 받아 사용하게 만든다.   
DI 적용을 위해 `UserService`도 스프링 빈으로 등록돼야 한다.   


#### 4. `userService.add()`  
   
처음 가입 시 사용자는 기본적으로 `BASIC` 레벨이어야 한다.   
이 로직은 어디에 담는 게 좋을까?   
`UserService`에도 `add()`를 만들어 두고 사용자가 등록될 때   
적용할 만한 비즈니스 로직을 담당하게 하면 된다.   


<br />   

## 트랜잭션 서비스 추상화         


 

































