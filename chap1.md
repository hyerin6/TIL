# 1장 오브젝트와 외존관계  

DB 연결을 위한 Connection을 가져와 SQL을 담은 Statement를 실행하는 작업인 
JDBC API 기본 사용 방법을 그대로 따라 만들면 동작은 하지만 문제점이 많다.   
DAO 코드를 객체지향 기술의 원리에 충실한 스프링 코드로 개선해보자.   

## 1. DAO의 분리 
관심이 같은 것끼리는 모으고, 관심이 다른 것은 따로 떨어져 있게 하는 것이다.   

**UserDao의 관심사항**     
- DB와 연결을 위한 커넥션을 어떻게 가져올까     
- DB에 보낼 SQL 문자을 담을 Statement를 만들고 실행    
- 사용한 리소스인 Statement와 Connection 오브젝트를 닫아서 공유 리소스를 시스템에 돌려주는 것     

지금 위 관심사항이 전부 UserDao에 구현되어 있다.   

하나의 관심사가 중복되어 있고, 여기저기 흩어져 있어서 다른 관심의 대상과 얽혀 있으면,     
변경이 일어날 때 많은 양의 코드를 함께 변경해야 한다.    

**중복 코드의 메소드 추출**  
커넥션을 가져오는 중복된 코드를 분리해보자.     
`getConnection()` 이라는 이름의 독립적인 메소드를 만들고   
각 DAO 메소드에서 이 메소드를 호출해 DB 커넥션을 가져오게 만든다.   


## 2. DB 커넥션 만들기의 독립   
N사와 D사가 각기 다른 다른 종류의 DB를 사용하고 DB 커넥션을 사용하는 데 있어 독자적인 방법을 적용하고 싶어한다면?   
UserDao 소스코드를 제공해버릴 수도 있지만 고객에게는 컴파일된 클래스 바이너리 파일만 제공하고 싶다.   
이런 경우에는 어떻게 UserDao를 제공할 수 있을까?  

#### 상속을 통한 확장   
UserDao에서 메소드의 구현 코드를 제거하고 getConnection()을 추상 메소드로 만들어 놓는다.   
추상 메소드라서 이 메소드를 호출하는 코드는 그대로 유지할 수 있다.   

추상 클래스인 UserDao를 판매하면 N사와 D사에서 서브클래스를 만들어 원하는 방식대로 구현할 수 있다.   
DB 연결을 어떻게 할 것인가라는 관심을 담고 있는 NUserDao와 DUserDao가 클래스 레벨로 구분되어   
클래스 계층구조를 통해 두 개의 관심이 독립적으로 분리되면서 변경 작업이 용이해졌다.   


이렇게 슈퍼클래스에 기본적인 로직의 흐름을 만들고,     
그 기능의 일부를 추상 메소드나 오버라이딩이 가능한 protected 메소드 등으로     
만든 뒤 서브클래스에서 필요에 맞게 사용하도록 하는 방법을 디자인 패턴에서 템플릿 메소드 패턴,       
어떤 Connection 클래스의 오브젝트를 어떻게 생성할 것인지를 결정하는 방법     
즉, 서브클래스에서 구체적인 오브젝트 생성 방법을 결정하게 하는 것을 팩토리 메소드 패턴이라고 부르기도 한다.      


템플릿 메소드 패턴 또는 팩토리 메소드 패턴으로 관심사항이 다른 코드를 분리해내고,   
서로 독립적으로 변경 또는 확장할 수 있도록 만드는 것은 간단하면서도 효과적인 방법이다.     

하지만 이 방법은 상속을 사용했다는 단점이 있다.    

(1) 자바는 클래스의 다중 상속을 허용하지 않는다.    
(2) 상속을 통한 상하위 클래스의 관계가 생각보다 밀접하다. (관심사에 대한 긴밀한 결합)   

이로 인해 생기는 문제점은 다음과 같다. 

- 서브클래스는 슈퍼클래스의 기능을 직접 사용할 수 있는데   
슈퍼클래스의 내부 변경이 있을 때 모든 서브클래스를 함께 수정하거나 다시 개발해야 할 수도 있다.   

- 확장된 기능인 DB 커넥션 생성 코드를 다른 DAO 클래스에 적용할 수 없다.   
DAO 클래스마다 getConnection() 코드가 중복될 수 있다.   





