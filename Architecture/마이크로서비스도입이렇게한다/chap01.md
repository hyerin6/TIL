# 1장 더도 덜도 아닌 딱 마이크로서비스       

## 마이크로서비스란?
비즈니스 도메인을 중심으로 모델링된 독립적으로 배포 가능한 서비스다.     
마이크로서비스는 네트워크를 통해 서로 통신하며, 마이크로서비스 아키텍처는 여러 선택지를 제공한다.   
→ 마이크로서비스 아키텍처는 여러 협업 마이크로서비스를 기반으로 한다.       

* 독립적인 배포가 핵심이지만, SOA(서비스 지향 아키텍처)의 한 유형   
* 기술에 중립적이라는 장점이 있음 
* 기술 관점에서 하나 이상의 네트워크 종단점을 통해 캡슐화되는 비즈니스 기능을 외부에 공개 
    - 네트워크를 통해 통신: 분산 시스템이라는 형태를 구성   
* 잘 정의된 인터페이스를 통해, 데이터베이스를 캡슐화하고 데이터를 외부에 공개
    - 데이터 저장 및 검색을 캡슐화, 데이터베이스는 서비스 경계 내부에 숨겨져 있다.   

<br />

### 독립적인 배포 가능성
독립적인 배포 가능성이란 다른 서비스를 활용하지 않고서 마이크로서비스에 변경을 가하는 방식으로 서비스 환경에 배포할 수 있다는 개념이다.   

독립적인 배포를 위해서는 서비스가 느슨하게 결합되어 있음을 보장해야 한다.   
즉 다른 서비스를 변경하지 않고도 특정 서비스를 변경할 수 있는 능력을 갖출 필요가 있다.   
→ 서비스가 명시적이고 잘 정의되며 안정적인 계약이 필요함을 의미  
이를 어렵게 하는 가장 큰 부분이 데이터베이스 공유이다.  

<br />

### 비즈니스 도메인을 중심으로 하는 모델링   
프로세스 경계를 넘어서는 변경에는 비용이 많이 든다.

가상의 도메인과 회사를 사용해 특정 개념을 알아보자.  

```
회사: CD 판매가 주력 분야임에도 오늘날 가까스로 살아남은 대규모 다국적기업인 '뮤직'이라는 이름의 음반사         
```


다음 그림에서 웹 기반 사용자 인터페이스, 모놀리스 백엔드 형태의 비즈니스 로직 계층, 전통적인 데이터베이스 형태의 데이터 저장소 등 간단한 3계층 아키텍처를 볼 수 있다.   
각 계층은 각기 다른 팀이 소유한다.


![img.png](../img/image1.png)


<br />

### 기능 변경: 선호하는 음악 장르 지정 기능 추가 
* 장르 선택을 위한 UI 
* 장르를 UI에 노출하고 값을 변경할 수 있는 백엔드 
* 변경을 수용하는 데이터베이스 

위 시스템에서 이런 변경사항은 각 팀에서 관리하고, 올바른 순서로 배포해야 한다.  
<br />

```text
- 훨씬 더 빠른 소프트웨어 출시를 원한다. 
- 업무 이관과 사일로 현상을 줄이길 원한다. 
```

> 사일로 현상이란?     
> 사일로 효과(Silo effect)란 회사 내부의 부서들이 다른 부서와 높은 칸막이를 형성하고   
> 내부의 이익만을 추구하는 현상을 의미한다.  

<br />  



### 3계층 아키텍처의 기능 변경  
* 기능 변경은 주로 비즈니스 기능의 변경에 초점을 맞춘다.   
* 3계층 아키텍처는 비즈니스 기능이 3개 계층으로 분산되어 있다.    
  → 기능 변경이 여러 계층에 걸쳐 있을 가능성이 높다.     
* 기술 관점: 응집력이 높다. 
* 비즈니스 관점: 응집력이 낮다. 

<br />
 
### 쉽게 변경하고 싶다면?
* 코드를 그룹화하는 방식을 바꿔야 한다. 
* 기술보다는 비즈니스 기능의 응집력을 선택할 필요가 있다. 

<br />

### 대안 아키텍처
![image2](../img/image2.png)


위 대안 아키텍처는 정보를 수정할 수 있도록 고객에게 UI를 외부에 공개하는 전용 고객 서비스가 있으며, 고객 상태도 이 서비스에 저장된다.    
선호 장르의 선택은 **특정 고객과 연관**되므로, 이러한 변경은 더욱 **지역화**된다.  


<br />


### 데이터 소유권 문제 
* 어떤 서비스에서 다른 서비스가 보유한 데이터에 접근하고 싶다면 데이터를 보유한 서비스를 찾아서 해당 데이터를 요청해야 마땅하다.   
* 안정적인 공개 계약으로 서비스를 매핑 => 안정적인 서비스 인터페이스를 보장 <= 독립적인 배포 가능성

<br />

### 마이크로서비스의 장점 
* 배포의 독립적인 특성 
    - 시스템 확장성, 견고성 개선
    - 서비스의 병렬 개발 작업 가능 
    - 프로세스 격리 => 다양한 기술 선택이 가능하다. 


* 위 장점 중 어떤 것도 공짜로 얻을 수는 없다. 

<br />

### 마이크로서비스가 야기하는 문제점 
* 네트워크 
    - 네트워크를 거치는 컴퓨터 간의 통신은 즉각적이지 않다. 
    - 다른 기술 종류 도입 => 트랜잭션, 안전성 포기 


* 모놀리스로 분류한 거의 모든 시스템도 사실상 분산 시스템이다.
    - 최소한 컴퓨터 3대: 데이터베이스, 애플리케이션, 웹 브라우저 


<br />

### 사용자 인터페이스 
* 새로운 기능을 더 신속하게 배포할 수 있는 아키텍처를 원한다면,   
  UI는 단일 모놀리스 계층으로 남겨두는 것은 큰 실수가 될 수 있다.  

<br />

### 기술 
* 마이크로서비스는 기본적으로 기술에 중립적이다. 
    - 네트워크를 제외한 나머지는 무엇이든 선택 가능 
  

* 일부 기술 스택에 대한 우월의식이 팽배 


* 문제가 발생하면 바로 해결할 수 있도록 시스템을 변경 

<br />

### 규모 

```text
마이크로서비스는 얼마나 커야 합니까?
```

* 마이크로서비스의 목표는 `가능한 작은 인터페이스를 유지하는 것` - 크리스 리처드슨 
    - 정보의 은닉 개념 


* 규모의 개념은 맥락에 크게 의존한다.   
      

* 집중할 사항 
    - 우리는 얼마나 많은 마이크로서비스를 다룰 수 있는가?
         + 서비스가 많아지면 → 시스템 복잡성 증가 → 이를 대처하기 위한 새로운 기술을 배워야 한다.    
    - 마이크로서비스를 최대한 활용하기 위해 경계를 정의하는 방법은 무엇일까?


<br />

### 소유권
#### Before
전통적인 IT 조직에서 소프트웨어 개발이라는 행위는 아래 그림과 같이 실제로 요구사항을 정의하고 고객과 연결된 비즈니스와는 완전히 분리된 부분에서 처리된다.     
다음과 같은 유형의 조직에서 발행하는 기능 장애는 매우 많고 다양하다. 


![img_1.png](img_1.png)

<br />


#### After
진정한 기술 조직이란 조직적이며 분리된 기존의 사일로를 완전히 결합한 형태다.   

![img_2.png](img_2.png)

마이크로서비스 아키텍처를 통해 이런 변화는 훨씬 더 쉬워진다.   
* 배포 팀이 제품 라인을 중심으로 나란히 정렬 
* 서비스가 비즈니스 도메인을 중심으로 정렬
* 제품을 지향하는 배포 팀에 소유권을 명확하게 할당하는 작업이 쉬워짐
* 여러 팀에서 공유되는 서비스를 축소하는 것은 배포 경합을 최소화하기 위한 핵심 

<br />
<br />

## 모놀리스 
이 책에서 모놀리스는 주로 배포 단위를 말하는 것이다.   

```
시스템의 모든 기능을 함꼐 배포해야 할 때 = 모놀리스   
```

<br />

### 단일 프로세스 모놀리스 
모놀리스의 가장 일반적인 예: 모든 코드가 단일 프로세스로 배포되는 시스템   

* 견고성, 확장성등의 이유로 이 프로세스의 인스턴스가 여러 개 있을 수 있다. 































