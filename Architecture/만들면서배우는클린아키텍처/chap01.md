# 계층형 아키텍처의 문제   

<img width="300" src="https://user-images.githubusercontent.com/33855307/152487080-a3f90a7a-774d-4d0f-b580-d7f1c625f667.jpeg"/>

계층형 아키텍처는 견고한 아키텍처 패턴이고, 잘 이해하고 구성하면 독립적인 도메인 로직을 작성할 수 있다.     
웹 계층, 영속성 계층도 마찬가지로 기존 기능에 영향을 주지 않고 기술을 변경할 수 있다.    

그렇다면 문제점은?   
계층형 아키텍처는 코드에 나쁜 습관들이 스며들기 쉽고 시간이 지날수록 소프트웨어를 점점 더 변경하기 어렵게 만드는 허점들을 노출한다.   

<br />  

### 1) 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다.   
정의에 따르면 계층형 아키텍처의 토대는 데이터베이스다.   

```text
웹 → 도메인 → 영속성 → 데이터베이스 
```

자연스레 **데이터베이스에 의존**하게 된다.    
모든 것이 영속성 계층을 토대로 만들어지기 때문에 이런 방식은 다양한 이유로 문제를 초래한다.   

애플리케이션의 목적은 비즈니스 규칙이나 정책을 반영한 모델을 만들어 사용자가 더욱 편리하게 활용하기 위함이다.   

우리는 상태가 아니라 **행동을 중심으로 모델링**하는데   
행동이 상태를 바꾸는 주체이기 때문에 행동이 비즈니스를 이끌어간다.   

그렇다면 왜 도메인 로직이 아닌 데이터베이스를 토대로 아키텍처를 만들었을까?   
유스케이스를 만들 때 디비 구조를 먼저 생각하고 이를 토대로 도메인 로직을 구현했다면,   
전통적인 계층형 아키텍처에서는 합리적인 방법이었다. (의존성 방향에 따라 구현)   
하지만 비즈니스 관점에서는 전혀 맞지 않는 방법이다.   
도메인 로직을 먼저 만들어야 한다.   

**데이터베이스 중심적인 아키텍처가 만들어지는 가장 큰 원인은 ORM 프레임워크를 사용하기 때문이다.**     
<br />  

<img width="500" src="https://user-images.githubusercontent.com/33855307/152488553-6f0b2e7e-0d30-4007-b6b0-75d2bd17be4d.jpeg">

**도메인 계층에서 데이터베이스 엔티티를 사용하는 것은 영속성 계층과의 강한 결합을 유발한다.**          

ORM에 의해 관리되는 엔티티들은 일반적으로 영속성 계층에 둔다.     
계층은 아래 방향으로만 접근 가능하기 때문에 도메인 계층에서 엔티티에 접근할 수 있다.      

서비스는 영속성 모델을 비즈니스 모델처럼 사용하게 되고 도메인 로직뿐만 아니라     
즉시로딩/지연로딩, 데이터베이스 트랜잭션, 캐시 플러시 등 영속성 계층과 관련된 작업들을 해야만 한다.    

영속성 코드가 도메인 코드에 녹아들어가 둘 중 하나만 바꾸는 것이 어려워진다.    
이는 유연하고 선택의 폭을 넓혀준다던 계층형 아키텍처의 목표와 반대되는 상황이다.   

<br />

### 2) 지름길을 택하기 쉬워진다.   


















